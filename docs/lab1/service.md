## Структура

Проект представляет собой серверное приложение на **FastAPI**, использующее **PostgreSQL** и **SQLAlchemy** для работы с базой данных.  
Миграции выполняются с помощью **Alembic**.  

### Основные сущности и связи
- `User` – зарегистрированные пользователи.
- `Psychologist` – психологи, которые привязаны к `User` (один-к-одному).
- `Review` – отзывы, связывающие `User` (клиента) и `Psychologist` (многие-к-одному).
- `Specialization` – специализации, которые могут быть у нескольких психологов (многие-ко-многим).
- `Schedule` – расписание работы психолога (один-ко-многим).
- `Appointment` – записи клиентов на консультации (многие-к-одному).

## Эндпоинты API

### 1. **Аутентификация и пользователи**

#### **Регистрация пользователя**
**POST /users/register**  
Регистрирует нового пользователя.

**Тело запроса (JSON):**
```json
{
  "email": "example@example.com",
  "full_name": "Имя Фамилия",
  "phone": "+79998887766",
  "password": "securepassword"
}
```

**Ответ (200 OK):**
```json
{
  "id": 1,
  "email": "example@example.com",
  "full_name": "Имя Фамилия",
  "phone": "+79998887766",
  "created_at": "2025-03-13T06:44:52.450633"
}
```

---

#### **Авторизация (получение токена)**
**POST /users/login**  
Возвращает JWT-токен для авторизованного пользователя.

**Тело запроса (JSON):**
```json
{
  "email": "example@example.com",
  "password": "securepassword"
}
```

**Ответ (200 OK):**
```json
{
  "access_token": "jwt_token_here",
  "token_type": "bearer"
}
```

---

#### **Получение информации о текущем пользователе**
**GET /users/me**  
Требует аутентификацию. Возвращает данные текущего пользователя.

**Заголовок запроса:**
```
Authorization: Bearer jwt_token_here
```

**Ответ (200 OK):**
```json
{
  "id": 1,
  "email": "example@example.com",
  "full_name": "Имя Фамилия",
  "phone": "+79998887766",
  "created_at": "2025-03-13T06:44:52.450633"
}
```

---

#### **Смена пароля**
**PUT /users/change-password**  
Требует аутентификацию.

**Тело запроса (JSON):**
```json
{
  "new_password": "newsecurepassword"
}
```

**Ответ (200 OK):**
```json
{
  "message": "Пароль успешно изменён"
}
```

---

#### **Удаление пользователя**
**DELETE /users/delete**  
Требует аутентификацию. Удаляет текущего пользователя.

**Ответ (200 OK):**
```json
{
  "message": "Пользователь успешно удалён"
}
```

---

### 2. **Психологи**

#### **Регистрация пользователя как психолога**
**POST /psychologists/**  
Требует аутентификацию. Привязывает `User` к `Psychologist`.

**Тело запроса (JSON):**
```json
{
  "experience": 5,
  "bio": "Описание психолога",
  "price_per_hour": 3000
}
```

**Ответ (200 OK):**
```json
{
  "id": 1,
  "user": {
    "id": 2,
    "email": "psychologist@example.com",
    "full_name": "Имя Фамилия",
    "phone": "+79998887766",
    "created_at": "2025-03-13T06:44:52.450633"
  },
  "experience": 5,
  "specializations": [],
  "schedule": [],
  "reviews": [],
  "rating": 0.0
}
```

---

#### **Получение информации о психологе**
**GET /psychologists/{psychologist_id}**  
Возвращает данные о психологе по его ID.

**Пример запроса:**
```
GET /psychologists/1
```

**Ответ (200 OK):**
```json
{
  "id": 1,
  "user": {
    "id": 2,
    "email": "psychologist@example.com",
    "full_name": "Имя Фамилия",
    "phone": "+79998887766",
    "created_at": "2025-03-13T06:44:52.450633"
  },
  "experience": 5,
  "specializations": [],
  "schedule": [],
  "reviews": [],
  "rating": 0.0
}
```

---

### 3. **Отзывы**

#### **Добавление отзыва**
**POST /reviews/**  
Требует аутентификацию. Клиент оставляет отзыв психологу.

**Тело запроса (JSON):**
```json
{
  "client_id": 1,
  "psychologist_id": 2,
  "rating": 4,
  "comment": "Хороший специалист"
}
```

**Ответ (200 OK):**
```json
{
  "id": 1,
  "client_id": 1,
  "psychologist_id": 2,
  "rating": 4,
  "comment": "Хороший специалист",
  "created_at": "2025-03-13T07:30:00.450633"
}
```

---

#### **Получение отзывов о психологе**
**GET /reviews/{psychologist_id}**  
Возвращает список отзывов по ID психолога.

**Пример запроса:**
```
GET /reviews/2
```

**Ответ (200 OK):**
```json
[
  {
    "id": 1,
    "client_id": 1,
    "psychologist_id": 2,
    "rating": 4,
    "comment": "Хороший специалист",
    "created_at": "2025-03-13T07:30:00.450633"
  }
]
```

---

### 4. **Специализации**
#### **Получение списка специализаций**
**GET /specializations/**  
Возвращает список всех специализаций.

**Ответ (200 OK):**
```json
[
  {
    "id": 1,
    "name": "Когнитивно-поведенческая терапия",
    "description": "Описание метода"
  },
  {
    "id": 2,
    "name": "Гештальт-терапия",
    "description": "Описание метода"
  }
]
```

---

### 5. **Расписание**
#### **Получение расписания психолога**
**GET /schedule/{psychologist_id}**  
Возвращает расписание психолога.

**Ответ (200 OK):**
```json
[
  {
    "id": 1,
    "psychologist_id": 2,
    "day_of_week": "Понедельник",
    "start_time": "09:00",
    "end_time": "18:00"
  }
]
```

---

## **Особенности**
- Авторизация реализована с **JWT-токенами**.
- Все эндпоинты, требующие авторизации, используют заголовок:  
  ```
  Authorization: Bearer <токен>
  ```
- `rating` психолога рассчитывается автоматически на основе отзывов.
- `Psychologist` и `User` связаны один-к-одному.
- `Specialization` и `Psychologist` имеют связь многие-ко-многим.
- `Review` и `Schedule` связаны с `Psychologist` через один-ко-многим.
